const QuartzIcons = {
  ColdSteel: {
    白羊: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/白羊.webp"
      ),
      width: 76,
      height: 76,
    },
    北风: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/北风.webp"
      ),
      width: 76,
      height: 76,
    },
    丛云: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/丛云.webp"
      ),
      width: 76,
      height: 76,
    },
    大蛇: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/大蛇.webp"
      ),
      width: 76,
      height: 76,
    },
    渡鸦: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/渡鸦.webp"
      ),
      width: 76,
      height: 76,
    },
    法则: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/法则.webp"
      ),
      width: 76,
      height: 76,
    },
    钢铁: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/钢铁.webp"
      ),
      width: 76,
      height: 76,
    },
    红莲: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/红莲.png"
      ),
      width: 163,
      height: 161,
    },
    幻象: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/幻象.webp"
      ),
      width: 76,
      height: 76,
    },
    金牛: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/金牛.webp"
      ),
      width: 76,
      height: 76,
    },
    巨石: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/巨石.webp"
      ),
      width: 76,
      height: 76,
    },
    雷神: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/雷神.webp"
      ),
      width: 76,
      height: 76,
    },
    力量: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/力量.webp"
      ),
      width: 76,
      height: 76,
    },
    灵猫: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/灵猫.webp"
      ),
      width: 76,
      height: 76,
    },
    魔盒: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/魔盒.webp"
      ),
      width: 76,
      height: 76,
    },
    骑士: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/骑士.webp"
      ),
      width: 76,
      height: 76,
    },
    权杖: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/权杖.webp"
      ),
      width: 76,
      height: 76,
    },
    神盾: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/神盾.webp"
      ),
      width: 76,
      height: 76,
    },
    天使: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/天使.webp"
      ),
      width: 76,
      height: 76,
    },
    纹章: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/纹章.webp"
      ),
      width: 76,
      height: 76,
    },
    无限: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/无限.webp"
      ),
      width: 76,
      height: 76,
    },
    贤者: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/贤者.webp"
      ),
      width: 76,
      height: 76,
    },
    小丑: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/小丑.webp"
      ),
      width: 76,
      height: 76,
    },
    虚无: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/虚无.webp"
      ),
      width: 76,
      height: 76,
    },
    迅隼: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/迅隼.webp"
      ),
      width: 76,
      height: 76,
    },
    勇气: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/勇气.webp"
      ),
      width: 76,
      height: 76,
    },
    羽翼: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/羽翼.webp"
      ),
      width: 76,
      height: 76,
    },
    罪恶: {
      file: dv.fileLink(
        "图片/游戏攻略/英雄传说/英雄传说 闪之轨迹/笔记/核心回路/罪恶.webp"
      ),
      width: 76,
      height: 76,
    },
  },
  ColdSteelII: {},
  ColdSteelIII: {},
  ColdSteelIV: {},
  Reverie: {},
};

const DefaultOptions = {
  size: 20,
  category: "ColdSteel",
  mode: "list", // list, table, inline
  seperator: " , ",
};

const MergeOptions = (options) => {
  return Object.assign(DefaultOptions, options);
};

const GetIcon = (name, category) => {
  const checkCategory = Object.keys(QuartzIcons).includes(category);
  if (checkCategory) {
    return Object.keys(QuartzIcons[category]).includes(name)
      ? QuartzIcons[category][name]
      : null;
  }
  return null;
};

const GetDisplaySize = (icon, size) => {
  const { width, height } = icon;
  return Math.round((width * size) / height);
};

const BuildHTML = (quartz, options) => {
  const {
    file: { name, link, path },
  } = quartz;
  const { size, category } = options;
  const icon = GetIcon(name, category);
  if (icon) {
    return `<img width="${GetDisplaySize(icon, size)}" src="${
      this.app.vault.adapter.basePath
    }/${icon.file.path}" /> ${link}`;
  }
  return "";
};

const RenderQuartz = (quartz, options) => {
  const quartzObject = dv.page(quartz.path || quartz.file.path);
  dv.span(BuildHTML(quartzObject, options));
};

const RenderQuartzs = (quartzs, options) => {
  quartzs = quartzs.map((q) => dv.page(q.path || q.file.path));
  const { mode, seperator } = options;
  mode === "inline"
    ? dv.span(quartzs.map((q) => BuildHTML(q, options)).join(seperator))
    : mode === "list"
    ? dv.list(quartzs.map((q) => BuildHTML(q, options)))
    : dv.table(
        [],
        quartzs.map((q) => [BuildHTML(q, options)])
      );
};

const { quartz, options } = input;
Array.isArray(quartz)
  ? RenderQuartzs(quartz, MergeOptions(options))
  : RenderQuartz(quartz, MergeOptions(options));
